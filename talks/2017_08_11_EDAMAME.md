---
title :       mothur
date :        August 11, 2017
author :      Patrick D. Schloss, PhD (@PatSchloss)
job :         Department of Microbiology & Immunology
framework :   io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme :     tomorrow      #
widgets :     []            # {mathjax, quiz, bootstrap}
mode :        selfcontained    # {selfcontained, standalone, draft}
knit :        slidify::knit2slides

--- .segue .dark

## Background


<script type="text/javascript">

</script>

--- &vcenter

<img src="assets/img/1000genome.jpg" style="margin:0px auto;display:block" width="900">

---

## Why do I do it?
> * Started as a postdoc in Jo Handelsman's lab
> * I have the ability to code and translate that ability to biologists - if we can develop the tools then surely others will benefit  
> * I don't like how others benchmark/validate methods
> * My lab needs software to analyze data and the tools are either poorly developed/tested or not available  

--- &vcenter

<img src="assets/img/mothurtitlepage.jpg" style="margin:0px auto;display:block" width="900">

--- &twocol
## Extensive resources

*** {name: left}
* [splash page](http://www.mothur.org)
* [github repository](https://github.com/mothur/mothur)
* [analysis examples](http://www.mothur.org/wiki/Analysis_examples)
* [wiki](http://www.mothur.org/wiki)
* [forum](http://www.mothur.org/forum)
* [blog](http://blog.mothur.org)
* [mailing list](https://groups.io/g/mothur)
* [twitter](https://twitter.com/PatSchloss)
* Amazon AMI
* [facebook](http://www.facebook.com/mothur)

*** {name: right}
<img src="assets/img/mothur_RGB.png" style="margin:0px auto;display:block", width=500>

---

## Who is the typical end user?
* Not programmers
    * 40% have no programming background
    * 33% know Perl
    * 35% know R
    * 10-20% know C/C++, Java, Python, SQL, or shell
* Probably uncomfortable with shell
    * 48% Windows
    * 33% Mac OSX
    * 45% Linux

---

## Think of yourself, your students, or your colleagues...
> * How do we react to foreign jargon?
    * Cloud?
    * Version control?
    * Dependencies?
    * JSON/HDFS/LNPR?
> * Our goal is to meet the users where they are and bring them up. Not to make them feel dumb.
    * GUI
    * Examples and documentation
    * Forum
    * Workshops

---

## What we developed
* Stand-alone, platform-independent, open source, community supported (-ive) software package
* Builds upon popularity of DOTUR, which was published in 2005 (1768 citations; as of 7/12/2016)
* The design is very PAUP*/R-ish
* We want to serve the people in coach, not the cockpit

--- &twocol

## What does this look like?
*** {name: left}
* **Obvious** (e.g. Venn diagrams, de-convolution, heat maps)
* **De novo** (e.g. sequence trimming and filtering)
* **Derivative** (e.g. cluster, rarefaction curves, PCoA)
* **Ports of original source code** (e.g. UClust, Clearcut, CatchAll)
* **Some we re-write** (e.g. aligner, classifier, metastats, etc.)

*** {name: right}
* **Make open source** (e.g. aligner, ESPRIT)
* **Make more flexible** (e.g. classifier)
* **Add features** (e.g. ESPRIT, ChimeraSlayer)
* **Make platform independent** (e.g. sffinfo, AmpliconNoise)
* **Improve engineering** (e.g. aligner, PyroNoise)
* **Helps us to understand how things work**

---

## Pro/cons of strategy
* Will not serve "power users" - but they don't need us anyway
* Not always the same implementation
    * We do screw up on occasion
    * We can make things better and more accessible
* Too many options
    * This can be confusing
    *  Allow people to make bad choices

---

## How are we doing?

<img src="assets/img/citationcount.jpg" style="margin:0px auto;display:block" width="950">

**AltMetrics:**
* 5280 mailing list recipients
* 313 wiki articles
* 1672 forum members
* 13674 forum posts for 3634 topics

--- &twocol


## [Comparison shopping](http://blog.mothur.org/2016/01/12/mothur-and-qiime/)

*** {name: left}
## mothur
* very simple to install
* reimplements tools to improve speed and interface
* pipelines go step by step
* limited/bad data visualization
* focuses on building database-independent OTUs with high quality data


*** {name: right}
## QIIME
* defines dependency hell
* uses out of date, poorly written code (their mothur is 4+ yrs old)
* is very black boxy
* has data visualization built in (looks mediocre)
* focuses on building database-dependent OTUs with low quality data

--- .segue .dark

## Sequencing on the MiSeq

---
## Preliminaries
* Platforms
    * HiSeq/GAII - tons of paired 150 nt reads (goodluck!)
    * MiSeq - 12-15x10\^6 250PE reads or 22-25x10\^6 300PE reads
* Low complexity
    * Requires 5-10% PhiX spike in
    * Low cluster density
    * No need for staggered primers
* Need high quality data since we cannot resequence the same base more than twice

---

## Various approaches to sequencing 16S rRNA genes
> * Single read sequencing
> * Sequence through primer and index (Illumina's protocol)
    * Waste base calls
    * Requires two PCR steps to get adapters on (chimeras?)
> * Caporasso (EMP/AG/etc.)
    * Single index - large number of long primers
    * Generally being used with HiSeq (?)
> * Kozich/Schloss
    * Dual index - considerably fewer primers required
    * [Wet-lab SOP](https://github.com/SchlossLab/MiSeq_WetLab_SOP) available
*** =pnotes
To sequence 384 samples...
* By Caporasso you would need 384 + 1 primers
* By Kozich you would need 24 + 16 = 40 primers

---

## Which factors to consider before choosing a method?
> 1. Data quality
> 1. Number of reads
> 1. Sequence length
> 1. Cost  

---

## Importance of error rates
* Traditional genomics approach builds contigs and so errors are “solved” by increased coverage
* This is not possible for 16S rRNA sequencing
    * The sequencer can artificially generate biodiversity
    * Would like to have as fine-scale a resolution as possible
    * Additional unique sequences makes data curation/processing more challenging

---

## Questions
* Does a dual-index strategy work?
* Can we create a pipeline like we have for 454 that results in low error rate data?
* Is it possible to move beyond the Knight approach now that reads have gone from 150 to 250  to 300 bp to sequence longer regions?
* What are the principles of primer design so we can amplify other regions and genes?

--- bg:#FFFFFF
<img src="assets/img/primerlayout.jpg" width=950, style="margin:0px auto;display:block">

---  
## Dual indexing makes things easier

| # Samples | #F Primers | #R Primers | Reads/Sample*                   |
|:---------:|:----------:|:----------:|:------------------------------:|
| 96        | 12         | 8          | 156250  |
| 192       | 12         | 16         | 78125 |
| 384       | 24         | 16         | 39062 |
| 1536      | 48         | 32         | 9766|

# **\* assumes:** 15x10^6 reads per run

--- &vcenter
## Overlapping regions within the 16S rRNA gene

<img src="assets/img/regionlayout.jpg">

---
## Experimental design
* Amplified V34, V4, and V45 from mock community DNA and DNA isolated from human feces, mouse feces, and soil
* All samples amplified in triplicate with different barcodes (12 total samples)
* Have used same design/samples with other sequencing platforms (454, PacBio, IonTorrent)

---
## Mock community
* DNA from 21 bacterial isolates with genome sequences:  
     *Acinetobacter baumannii, Actinomyces odontolyticus, Bacillus cereus, Bacteroides vulgatus, Clostridium beijerinckii, Deinococcus radiodurans, Enterococcus faecalis, Escherichia coli, Helicobacter pylori, Lactobacillus gasseri, Listeria monocytogenes, Neisseria meningitidis, Porphyromonas gingivalis, Propionibacterium acnes, Pseudomonas aeruginosa, Rhodobacter sphaeroides, Staphylococcus aureus, Staphylococcus epidermidis, Streptococcus agalactiae, Streptococcus mutans, Streptococcus pneumoniae* (Available through BEI: v3.1, HM-278D)
* Since we know the true 16S rRNA gene sequences we can measure the error rates
* Can remove chimeras *a priori*

---

## Basic error correction
* Trust MiSeq software to call indices
* Form contigs between read pairs and resolve mismatch based on better quality score (same score = N)
* Remove anything with…
    * Ambiguous base calls
    * Homopolymer length greater than 8
    * Doesn’t map to correct region

---

## Error profile

<img src="assets/img/errorprofile.jpg" width="900">


---

## Make contigs
* Align forward and reverse reads to each other along with their quality scores
* If there is a mismatch the base a qual score that is greater than or equal to DQthreshold wins
* If it is less than DQthreshold the base becomes an N and the read will ultimately get rejected
* Contig length must make “sense”

---
## Error rates  

<img src="assets/img/errorrates.jpg" style="margin:0px auto;display:block" width="750">  
* The V4 region yields the best error rates and retains the most reads  
* Require Q to be at least 6 points higher to break a mismatch  

---

## Error rate summary

| Region  | Length | Error rate after making contigs (%) | Error rate after pre.cluster (%) |
|---------|--------|-------------------------------------|----------------------------------|
| V3-V4   | 429    | 0.41                                | 0.26                             |
| V4      | 253    | 0.04                                | 0.01                             |
| V4-V5   | 375    | 0.57                                | 0.26                             |
| "V3-V5" | 260    | 0.06                                | 0.02

# **"V3-V5":** Based on our 454 SOP using PyroNoise

---

## Richness
| Sample        | V3-V4          | V4            | V4-V5            |
|---------------|----------------|---------------|------------------|
| Mock - PC(20) | NA             | 21.4          | 83.5             |
| Mock - actual | NA             | 32.4          | 126.2            |
| Mouse         | NA             | 135.7         | 145.7            |
| Human         | NA             | 121.6         | 187.8            |
| Soil          | NA             | 1271.3        | 1221.2           |

# All rarefied to 5,000 reads
# (XX) – number of OTUs w/ no errors
# Mock-PC has no chimeras

* "Richness" is correlated with sequencing depth / crap
* Error rates have a significant impact on number of observed OTUs

---

## Error rate with new chemsitry

| Region  | Length | 250PE error rate after making contigs (%) | 300PE error rate after pre.cluster (%) |
|---------|--------|-------------------------------------------|----------------------------------------|
| V3-V4   | 429    | 0.41                                      | 0.80                                   |
| V4      | 253    | 0.04                                      | 0.04                                   |
| V4-V5   | 375    | 0.57                                      | 0.90                                   |
| "V3-V5" | 260    | 0.06                                      | NA                                     |

# **"V3-V5":** Based on our 454 SOP using PyroNoise


### Meh.

---

## Quality scores with the V3 chemistry

<img src="assets/img/qscores.jpg" style="margin:0px auto;display:block" width="900">

### Note that the quality scores crap out around cycle 500

---

## Concluding the MiSeq pipeline
* Sequence reads must fully overlap with each other to get good error remediation
* If they don't...
    * Inflated number of unique reads / OTUs
    * Samples will look more different than they really are
    * Significant computational hurdles await
    * Cheaper to throw data away and resquence correctly than to buy sufficient RAM/time
* The V3 MiSeq kit isn't going to cut it for longer reads

--- .segue .dark

## The rest of the pipeline

---

## The [MiSeq mothur SOP](http://www.mothur.org/wiki/MiSeq_SOP)
| method         | what it does... | reference    |
|----------------|-----------------|--------------|
| `make.contigs` | assemble reads  | [Kozich et al. 2014](http://www.ncbi.nlm.nih.gov/pubmed/23793624)
| `screen.seqs` | remove bad reads |
| `unique.seqs` | collapse duplicate reads |
| `count.seqs` | count frequency of each sequence in each sample |
| `align.seqs` | align sequences to a reference | [Schloss 2009](http://www.ncbi.nlm.nih.gov/pubmed/20011594), [Schloss 2010](http://www.ncbi.nlm.nih.gov/pubmed/20628621)
| `filter.seqs` | trim reads to same alignment space | [Schloss 2013](http://www.ncbi.nlm.nih.gov/pubmed/23018771)
| `pre.cluster` | remove one and two offs | [Schloss et al. 2011](http://www.ncbi.nlm.nih.gov/pubmed/22194782)
| `chimera.uchime` | identify and remove chimeras | [Edgar et al. 2011](http://www.ncbi.nlm.nih.gov/pubmed/21700674)
| `classify.seqs` | classify sequences against a database | [Wang et al. 2009](http://www.ncbi.nlm.nih.gov/pubmed/17586664)
| `remove.lineage` | remove contaminants |
| `cluster.split` | assign sequences to OTUs | [Schloss & Westcott 2011](http://www.ncbi.nlm.nih.gov/pubmed/21421784)
| `phylotype` | assign sequences to phylotypes |
| `make.shared` | generate sample by OTU frequency table |
| `clearcut` | generate a neighbor-joining tree | [Sheneman et al. 2006](http://www.ncbi.nlm.nih.gov/pubmed/16982706)

---

## Clustering

<img src="assets/img/all_cluster_method_comparison.jpg" style="margin:0px auto;display:block" width="900">

* Average neighbor clustering is consistently the best

---

<img src="assets/img/opticlust_method_comparison.jpg" style="margin:0px auto;display:block" width="800">




--- &twocol w1:35% w2:55%
## Philosophy
*** {name: left}
* mothur is one tool you have for analyzing your 16S rRNA gene sequences
* We cannot envision or accomodate every analysis need that every researcher has
* You need to take the next step of learning R or python to make your analysis unique

*** {name: right}

<script src="CanvasMatrix.js" type="text/javascript"></script>
<canvas id="unnamed_chunk_1textureCanvas" style="display: none;" width="256" height="256">
Your browser does not support the HTML5 canvas element.</canvas>
<!-- ****** spheres object 7 ****** -->
<script id="unnamed_chunk_1vshader7" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
attribute vec3 aNorm;
uniform mat4 normMatrix;
varying vec3 vNormal;
void main(void) {
vPosition = mvMatrix * vec4(aPos, 1.);
gl_Position = prMatrix * vPosition;
vCol = aCol;
vNormal = normalize((normMatrix * vec4(aNorm, 1.)).xyz);
}
</script>
<script id="unnamed_chunk_1fshader7" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
varying vec3 vNormal;
void main(void) {
vec3 eye = normalize(-vPosition.xyz);
const vec3 emission = vec3(0., 0., 0.);
const vec3 ambient1 = vec3(0., 0., 0.);
const vec3 specular1 = vec3(1., 1., 1.);// light*material
const float shininess1 = 50.;
vec4 colDiff1 = vec4(vCol.rgb * vec3(1., 1., 1.), vCol.a);
const vec3 lightDir1 = vec3(0., 0., 1.);
vec3 halfVec1 = normalize(lightDir1 + eye);
vec4 lighteffect = vec4(emission, 0.);
vec3 n = normalize(vNormal);
n = -faceforward(n, n, eye);
vec3 col1 = ambient1;
float nDotL1 = dot(n, lightDir1);
col1 = col1 + max(nDotL1, 0.) * colDiff1.rgb;
col1 = col1 + pow(max(dot(halfVec1, n), 0.), shininess1) * specular1;
lighteffect = lighteffect + vec4(col1, colDiff1.a);
gl_FragColor = lighteffect;
}
</script> 
<!-- ****** text object 9 ****** -->
<script id="unnamed_chunk_1vshader9" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
attribute vec2 aTexcoord;
varying vec2 vTexcoord;
uniform vec2 textScale;
attribute vec2 aOfs;
void main(void) {
vCol = aCol;
vTexcoord = aTexcoord;
vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);
pos = pos/pos.w;
gl_Position = pos + vec4(aOfs*textScale, 0.,0.);
}
</script>
<script id="unnamed_chunk_1fshader9" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
varying vec2 vTexcoord;
uniform sampler2D uSampler;
void main(void) {
vec4 colDiff = vCol;
vec4 lighteffect = colDiff;
vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);
if (textureColor.a < 0.1)
discard;
else
gl_FragColor = textureColor;
}
</script> 
<!-- ****** text object 10 ****** -->
<script id="unnamed_chunk_1vshader10" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
attribute vec2 aTexcoord;
varying vec2 vTexcoord;
uniform vec2 textScale;
attribute vec2 aOfs;
void main(void) {
vCol = aCol;
vTexcoord = aTexcoord;
vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);
pos = pos/pos.w;
gl_Position = pos + vec4(aOfs*textScale, 0.,0.);
}
</script>
<script id="unnamed_chunk_1fshader10" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
varying vec2 vTexcoord;
uniform sampler2D uSampler;
void main(void) {
vec4 colDiff = vCol;
vec4 lighteffect = colDiff;
vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);
if (textureColor.a < 0.1)
discard;
else
gl_FragColor = textureColor;
}
</script> 
<!-- ****** text object 11 ****** -->
<script id="unnamed_chunk_1vshader11" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
attribute vec2 aTexcoord;
varying vec2 vTexcoord;
uniform vec2 textScale;
attribute vec2 aOfs;
void main(void) {
vCol = aCol;
vTexcoord = aTexcoord;
vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);
pos = pos/pos.w;
gl_Position = pos + vec4(aOfs*textScale, 0.,0.);
}
</script>
<script id="unnamed_chunk_1fshader11" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
varying vec2 vTexcoord;
uniform sampler2D uSampler;
void main(void) {
vec4 colDiff = vCol;
vec4 lighteffect = colDiff;
vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);
if (textureColor.a < 0.1)
discard;
else
gl_FragColor = textureColor;
}
</script> 
<!-- ****** lines object 12 ****** -->
<script id="unnamed_chunk_1vshader12" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
void main(void) {
vPosition = mvMatrix * vec4(aPos, 1.);
gl_Position = prMatrix * vPosition;
vCol = aCol;
}
</script>
<script id="unnamed_chunk_1fshader12" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
void main(void) {
vec4 colDiff = vCol;
vec4 lighteffect = colDiff;
gl_FragColor = lighteffect;
}
</script> 
<!-- ****** text object 13 ****** -->
<script id="unnamed_chunk_1vshader13" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
attribute vec2 aTexcoord;
varying vec2 vTexcoord;
uniform vec2 textScale;
attribute vec2 aOfs;
void main(void) {
vCol = aCol;
vTexcoord = aTexcoord;
vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);
pos = pos/pos.w;
gl_Position = pos + vec4(aOfs*textScale, 0.,0.);
}
</script>
<script id="unnamed_chunk_1fshader13" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
varying vec2 vTexcoord;
uniform sampler2D uSampler;
void main(void) {
vec4 colDiff = vCol;
vec4 lighteffect = colDiff;
vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);
if (textureColor.a < 0.1)
discard;
else
gl_FragColor = textureColor;
}
</script> 
<!-- ****** lines object 14 ****** -->
<script id="unnamed_chunk_1vshader14" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
void main(void) {
vPosition = mvMatrix * vec4(aPos, 1.);
gl_Position = prMatrix * vPosition;
vCol = aCol;
}
</script>
<script id="unnamed_chunk_1fshader14" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
void main(void) {
vec4 colDiff = vCol;
vec4 lighteffect = colDiff;
gl_FragColor = lighteffect;
}
</script> 
<!-- ****** text object 15 ****** -->
<script id="unnamed_chunk_1vshader15" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
attribute vec2 aTexcoord;
varying vec2 vTexcoord;
uniform vec2 textScale;
attribute vec2 aOfs;
void main(void) {
vCol = aCol;
vTexcoord = aTexcoord;
vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);
pos = pos/pos.w;
gl_Position = pos + vec4(aOfs*textScale, 0.,0.);
}
</script>
<script id="unnamed_chunk_1fshader15" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
varying vec2 vTexcoord;
uniform sampler2D uSampler;
void main(void) {
vec4 colDiff = vCol;
vec4 lighteffect = colDiff;
vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);
if (textureColor.a < 0.1)
discard;
else
gl_FragColor = textureColor;
}
</script> 
<!-- ****** lines object 16 ****** -->
<script id="unnamed_chunk_1vshader16" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
void main(void) {
vPosition = mvMatrix * vec4(aPos, 1.);
gl_Position = prMatrix * vPosition;
vCol = aCol;
}
</script>
<script id="unnamed_chunk_1fshader16" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
void main(void) {
vec4 colDiff = vCol;
vec4 lighteffect = colDiff;
gl_FragColor = lighteffect;
}
</script> 
<!-- ****** text object 17 ****** -->
<script id="unnamed_chunk_1vshader17" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
attribute vec2 aTexcoord;
varying vec2 vTexcoord;
uniform vec2 textScale;
attribute vec2 aOfs;
void main(void) {
vCol = aCol;
vTexcoord = aTexcoord;
vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);
pos = pos/pos.w;
gl_Position = pos + vec4(aOfs*textScale, 0.,0.);
}
</script>
<script id="unnamed_chunk_1fshader17" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
varying vec2 vTexcoord;
uniform sampler2D uSampler;
void main(void) {
vec4 colDiff = vCol;
vec4 lighteffect = colDiff;
vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);
if (textureColor.a < 0.1)
discard;
else
gl_FragColor = textureColor;
}
</script> 
<!-- ****** lines object 18 ****** -->
<script id="unnamed_chunk_1vshader18" type="x-shader/x-vertex">
attribute vec3 aPos;
attribute vec4 aCol;
uniform mat4 mvMatrix;
uniform mat4 prMatrix;
varying vec4 vCol;
varying vec4 vPosition;
void main(void) {
vPosition = mvMatrix * vec4(aPos, 1.);
gl_Position = prMatrix * vPosition;
vCol = aCol;
}
</script>
<script id="unnamed_chunk_1fshader18" type="x-shader/x-fragment"> 
#ifdef GL_ES
precision highp float;
#endif
varying vec4 vCol; // carries alpha
varying vec4 vPosition;
void main(void) {
vec4 colDiff = vCol;
vec4 lighteffect = colDiff;
gl_FragColor = lighteffect;
}
</script> 
<script type="text/javascript">
function getShader ( gl, id ){
var shaderScript = document.getElementById ( id );
var str = "";
var k = shaderScript.firstChild;
while ( k ){
if ( k.nodeType == 3 ) str += k.textContent;
k = k.nextSibling;
}
var shader;
if ( shaderScript.type == "x-shader/x-fragment" )
shader = gl.createShader ( gl.FRAGMENT_SHADER );
else if ( shaderScript.type == "x-shader/x-vertex" )
shader = gl.createShader(gl.VERTEX_SHADER);
else return null;
gl.shaderSource(shader, str);
gl.compileShader(shader);
if (gl.getShaderParameter(shader, gl.COMPILE_STATUS) == 0)
alert(gl.getShaderInfoLog(shader));
return shader;
}
var min = Math.min;
var max = Math.max;
var sqrt = Math.sqrt;
var sin = Math.sin;
var acos = Math.acos;
var tan = Math.tan;
var SQRT2 = Math.SQRT2;
var PI = Math.PI;
var log = Math.log;
var exp = Math.exp;
function unnamed_chunk_1webGLStart() {
var debug = function(msg) {
document.getElementById("unnamed_chunk_1debug").innerHTML = msg;
}
debug("");
var canvas = document.getElementById("unnamed_chunk_1canvas");
if (!window.WebGLRenderingContext){
debug(" Your browser does not support WebGL. See <a href=\"http://get.webgl.org\">http://get.webgl.org</a>");
return;
}
var gl;
try {
// Try to grab the standard context. If it fails, fallback to experimental.
gl = canvas.getContext("webgl") 
|| canvas.getContext("experimental-webgl");
}
catch(e) {}
if ( !gl ) {
debug(" Your browser appears to support WebGL, but did not create a WebGL context.  See <a href=\"http://get.webgl.org\">http://get.webgl.org</a>");
return;
}
var width = 505;  var height = 505;
canvas.width = width;   canvas.height = height;
var prMatrix = new CanvasMatrix4();
var mvMatrix = new CanvasMatrix4();
var normMatrix = new CanvasMatrix4();
var saveMat = new Object();
var distance;
var posLoc = 0;
var colLoc = 1;
var zoom = new Object();
var fov = new Object();
var userMatrix = new Object();
var activeSubscene = 1;
zoom[1] = 1;
fov[1] = 30;
userMatrix[1] = new CanvasMatrix4();
userMatrix[1].load([
1, 0, 0, 0,
0, 0.3420201, -0.9396926, 0,
0, 0.9396926, 0.3420201, 0,
0, 0, 0, 1
]);
function getPowerOfTwo(value) {
var pow = 1;
while(pow<value) {
pow *= 2;
}
return pow;
}
function handleLoadedTexture(texture, textureCanvas) {
gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
gl.bindTexture(gl.TEXTURE_2D, texture);
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureCanvas);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);
gl.generateMipmap(gl.TEXTURE_2D);
gl.bindTexture(gl.TEXTURE_2D, null);
}
function loadImageToTexture(filename, texture) {   
var canvas = document.getElementById("unnamed_chunk_1textureCanvas");
var ctx = canvas.getContext("2d");
var image = new Image();
image.onload = function() {
var w = image.width;
var h = image.height;
var canvasX = getPowerOfTwo(w);
var canvasY = getPowerOfTwo(h);
canvas.width = canvasX;
canvas.height = canvasY;
ctx.imageSmoothingEnabled = true;
ctx.drawImage(image, 0, 0, canvasX, canvasY);
handleLoadedTexture(texture, canvas);
drawScene();
}
image.src = filename;
}  	   
function drawTextToCanvas(text, cex) {
var canvasX, canvasY;
var textX, textY;
var textHeight = 20 * cex;
var textColour = "white";
var fontFamily = "Arial";
var backgroundColour = "rgba(0,0,0,0)";
var canvas = document.getElementById("unnamed_chunk_1textureCanvas");
var ctx = canvas.getContext("2d");
ctx.font = textHeight+"px "+fontFamily;
canvasX = 1;
var widths = [];
for (var i = 0; i < text.length; i++)  {
widths[i] = ctx.measureText(text[i]).width;
canvasX = (widths[i] > canvasX) ? widths[i] : canvasX;
}	  
canvasX = getPowerOfTwo(canvasX);
var offset = 2*textHeight; // offset to first baseline
var skip = 2*textHeight;   // skip between baselines	  
canvasY = getPowerOfTwo(offset + text.length*skip);
canvas.width = canvasX;
canvas.height = canvasY;
ctx.fillStyle = backgroundColour;
ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
ctx.fillStyle = textColour;
ctx.textAlign = "left";
ctx.textBaseline = "alphabetic";
ctx.font = textHeight+"px "+fontFamily;
for(var i = 0; i < text.length; i++) {
textY = i*skip + offset;
ctx.fillText(text[i], 0,  textY);
}
return {canvasX:canvasX, canvasY:canvasY,
widths:widths, textHeight:textHeight,
offset:offset, skip:skip};
}
// ****** sphere object ******
var v=new Float32Array([
-1, 0, 0,
1, 0, 0,
0, -1, 0,
0, 1, 0,
0, 0, -1,
0, 0, 1,
-0.7071068, 0, -0.7071068,
-0.7071068, -0.7071068, 0,
0, -0.7071068, -0.7071068,
-0.7071068, 0, 0.7071068,
0, -0.7071068, 0.7071068,
-0.7071068, 0.7071068, 0,
0, 0.7071068, -0.7071068,
0, 0.7071068, 0.7071068,
0.7071068, -0.7071068, 0,
0.7071068, 0, -0.7071068,
0.7071068, 0, 0.7071068,
0.7071068, 0.7071068, 0,
-0.9349975, 0, -0.3546542,
-0.9349975, -0.3546542, 0,
-0.77044, -0.4507894, -0.4507894,
0, -0.3546542, -0.9349975,
-0.3546542, 0, -0.9349975,
-0.4507894, -0.4507894, -0.77044,
-0.3546542, -0.9349975, 0,
0, -0.9349975, -0.3546542,
-0.4507894, -0.77044, -0.4507894,
-0.9349975, 0, 0.3546542,
-0.77044, -0.4507894, 0.4507894,
0, -0.9349975, 0.3546542,
-0.4507894, -0.77044, 0.4507894,
-0.3546542, 0, 0.9349975,
0, -0.3546542, 0.9349975,
-0.4507894, -0.4507894, 0.77044,
-0.9349975, 0.3546542, 0,
-0.77044, 0.4507894, -0.4507894,
0, 0.9349975, -0.3546542,
-0.3546542, 0.9349975, 0,
-0.4507894, 0.77044, -0.4507894,
0, 0.3546542, -0.9349975,
-0.4507894, 0.4507894, -0.77044,
-0.77044, 0.4507894, 0.4507894,
0, 0.3546542, 0.9349975,
-0.4507894, 0.4507894, 0.77044,
0, 0.9349975, 0.3546542,
-0.4507894, 0.77044, 0.4507894,
0.9349975, -0.3546542, 0,
0.9349975, 0, -0.3546542,
0.77044, -0.4507894, -0.4507894,
0.3546542, -0.9349975, 0,
0.4507894, -0.77044, -0.4507894,
0.3546542, 0, -0.9349975,
0.4507894, -0.4507894, -0.77044,
0.9349975, 0, 0.3546542,
0.77044, -0.4507894, 0.4507894,
0.3546542, 0, 0.9349975,
0.4507894, -0.4507894, 0.77044,
0.4507894, -0.77044, 0.4507894,
0.9349975, 0.3546542, 0,
0.77044, 0.4507894, -0.4507894,
0.4507894, 0.4507894, -0.77044,
0.3546542, 0.9349975, 0,
0.4507894, 0.77044, -0.4507894,
0.77044, 0.4507894, 0.4507894,
0.4507894, 0.77044, 0.4507894,
0.4507894, 0.4507894, 0.77044
]);
var f=new Uint16Array([
0, 18, 19,
6, 20, 18,
7, 19, 20,
19, 18, 20,
4, 21, 22,
8, 23, 21,
6, 22, 23,
22, 21, 23,
2, 24, 25,
7, 26, 24,
8, 25, 26,
25, 24, 26,
7, 20, 26,
6, 23, 20,
8, 26, 23,
26, 20, 23,
0, 19, 27,
7, 28, 19,
9, 27, 28,
27, 19, 28,
2, 29, 24,
10, 30, 29,
7, 24, 30,
24, 29, 30,
5, 31, 32,
9, 33, 31,
10, 32, 33,
32, 31, 33,
9, 28, 33,
7, 30, 28,
10, 33, 30,
33, 28, 30,
0, 34, 18,
11, 35, 34,
6, 18, 35,
18, 34, 35,
3, 36, 37,
12, 38, 36,
11, 37, 38,
37, 36, 38,
4, 22, 39,
6, 40, 22,
12, 39, 40,
39, 22, 40,
6, 35, 40,
11, 38, 35,
12, 40, 38,
40, 35, 38,
0, 27, 34,
9, 41, 27,
11, 34, 41,
34, 27, 41,
5, 42, 31,
13, 43, 42,
9, 31, 43,
31, 42, 43,
3, 37, 44,
11, 45, 37,
13, 44, 45,
44, 37, 45,
11, 41, 45,
9, 43, 41,
13, 45, 43,
45, 41, 43,
1, 46, 47,
14, 48, 46,
15, 47, 48,
47, 46, 48,
2, 25, 49,
8, 50, 25,
14, 49, 50,
49, 25, 50,
4, 51, 21,
15, 52, 51,
8, 21, 52,
21, 51, 52,
15, 48, 52,
14, 50, 48,
8, 52, 50,
52, 48, 50,
1, 53, 46,
16, 54, 53,
14, 46, 54,
46, 53, 54,
5, 32, 55,
10, 56, 32,
16, 55, 56,
55, 32, 56,
2, 49, 29,
14, 57, 49,
10, 29, 57,
29, 49, 57,
14, 54, 57,
16, 56, 54,
10, 57, 56,
57, 54, 56,
1, 47, 58,
15, 59, 47,
17, 58, 59,
58, 47, 59,
4, 39, 51,
12, 60, 39,
15, 51, 60,
51, 39, 60,
3, 61, 36,
17, 62, 61,
12, 36, 62,
36, 61, 62,
17, 59, 62,
15, 60, 59,
12, 62, 60,
62, 59, 60,
1, 58, 53,
17, 63, 58,
16, 53, 63,
53, 58, 63,
3, 44, 61,
13, 64, 44,
17, 61, 64,
61, 44, 64,
5, 55, 42,
16, 65, 55,
13, 42, 65,
42, 55, 65,
16, 63, 65,
17, 64, 63,
13, 65, 64,
65, 63, 64
]);
var sphereBuf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, sphereBuf);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var sphereIbuf = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, sphereIbuf);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.STATIC_DRAW);
// ****** spheres object 7 ******
var prog7  = gl.createProgram();
gl.attachShader(prog7, getShader( gl, "unnamed_chunk_1vshader7" ));
gl.attachShader(prog7, getShader( gl, "unnamed_chunk_1fshader7" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog7, 0, "aPos");
gl.bindAttribLocation(prog7, 1, "aCol");
gl.linkProgram(prog7);
var v=new Float32Array([
0.139097, -0.163907, -0.108405, 1, 0, 0, 1, 0.01308494,
0.050417, -0.142943, -0.266162, 1, 0, 0, 1, 0.01308494,
0.052746, 0.079873, 0.002022, 1, 0, 0, 1, 0.01308494,
0.151699, -0.035784, 0.063416, 1, 0, 0, 1, 0.01308494,
-0.365654, -0.064408, -0.225379, 1, 0, 0, 1, 0.01308494,
0.113564, 0.05246, -0.08103, 1, 0, 0, 1, 0.01308494,
0.186942, 0.039941, 0.092235, 1, 0, 0, 1, 0.01308494,
0.137914, -0.207381, -0.098354, 1, 0, 0, 1, 0.01308494,
0.178443, 0.098824, 0.146326, 1, 0, 0, 1, 0.01308494,
0.233349, 0.100203, 0.078377, 1, 0, 0, 1, 0.01308494,
0.150238, 0.03049, 0.077217, 1, 0, 0, 1, 0.01308494,
0.084226, -0.014441, -0.126776, 1, 0, 0, 1, 0.01308494,
-0.239338, -0.179423, -0.260759, 1, 0, 0, 1, 0.01308494,
-0.230038, -0.271933, -0.328508, 1, 0, 0, 1, 0.01308494,
0.046368, 0.128319, -0.047488, 1, 0, 0, 1, 0.01308494,
-0.251015, -0.268145, -0.180223, 1, 0, 0, 1, 0.01308494,
-0.399933, -0.049218, -0.092927, 1, 0, 0, 1, 0.01308494,
-0.006846, 0.278597, -0.013437, 1, 0, 0, 1, 0.01308494,
0.022393, 0.149123, 0.068194, 1, 0, 0, 1, 0.01308494,
-0.029551, 0.043518, -0.324471, 1, 0, 0, 1, 0.01308494,
0.165872, 0.161744, -0.030044, 1, 0, 0, 1, 0.01308494,
0.116099, 0.090731, 0.061528, 1, 0, 0, 1, 0.01308494,
-0.212399, 0.044128, -0.264373, 1, 0, 0, 1, 0.01308494,
-0.149518, 0.171705, -0.275807, 1, 0, 0, 1, 0.01308494,
-0.109074, 0.154592, -0.041238, 1, 0, 0, 1, 0.01308494,
-0.378594, -0.001028, -0.039641, 1, 0, 0, 1, 0.01308494,
0.094235, 0.051955, 0.04779, 1, 0, 0, 1, 0.01308494,
-0.034953, 0.293675, -0.146311, 1, 0, 0, 1, 0.01308494,
0.056301, 0.20283, 0.0025, 1, 0, 0, 1, 0.01308494,
-0.119432, 0.014745, -0.212858, 1, 0, 0, 1, 0.01308494,
-0.176625, -0.107823, -0.336654, 1, 0, 0, 1, 0.01308494,
-0.025006, 0.196356, 0.091431, 1, 0, 0, 1, 0.01308494,
-0.219263, 0.142996, -0.077265, 1, 0, 0, 1, 0.01308494,
-0.144342, 0.160537, -0.197647, 1, 0, 0, 1, 0.01308494,
-0.163433, 0.321068, 0.166521, 1, 0, 0, 1, 0.01308494,
-0.472161, -0.382526, -0.081965, 1, 0, 0, 1, 0.01308494,
-0.251528, -0.252496, -0.314473, 1, 0, 0, 1, 0.01308494,
-0.271793, 0.236657, 0.059002, 1, 0, 0, 1, 0.01308494,
-0.130187, 0.03775, -0.008559, 1, 0, 0, 1, 0.01308494,
-0.269761, -0.070649, -0.158571, 1, 0, 0, 1, 0.01308494,
-0.166481, -0.042579, -0.191841, 1, 0, 0, 1, 0.01308494,
-0.23146, 0.011627, -0.252747, 1, 0, 0, 1, 0.01308494,
-0.117631, 0.228305, 0.168298, 1, 0, 0, 1, 0.01308494,
-0.18027, 0.017486, -0.169064, 1, 0, 0, 1, 0.01308494,
-0.047715, 0.167811, 0.067555, 1, 0, 0, 1, 0.01308494,
-0.412871, -0.052939, 0.036466, 1, 0, 0, 1, 0.01308494,
-0.263458, 0.081906, -0.094086, 1, 0, 0, 1, 0.01308494,
-0.170934, 0.361583, -0.043057, 1, 0, 0, 1, 0.01308494,
0.03841, 0.150354, 0.056559, 1, 0, 0, 1, 0.01308494,
-0.222283, 0.052202, -0.173436, 1, 0, 0, 1, 0.01308494,
-0.21676, -0.134476, -0.041016, 1, 0, 0, 1, 0.01308494,
-0.15963, 0.152646, 0.035772, 1, 0, 0, 1, 0.01308494,
-0.116077, 0.070939, 0.002476, 1, 0, 0, 1, 0.01308494,
-0.03861, 0.322659, 0.101128, 1, 0, 0, 1, 0.01308494,
-0.214196, -0.127805, -0.143752, 1, 0, 0, 1, 0.01308494,
-0.111124, 0.142759, -0.150522, 1, 0, 0, 1, 0.01308494,
-0.456525, -0.290524, 0.277068, 1, 0, 0, 1, 0.01308494,
-0.486134, -0.448886, 0.081963, 1, 0, 0, 1, 0.01308494,
-0.343594, 0.067568, -0.081526, 1, 0, 0, 1, 0.01308494,
-0.461983, -0.310029, 0.159765, 1, 0, 0, 1, 0.01308494,
-0.148287, 0.168388, -0.179764, 1, 0, 0, 1, 0.01308494,
-0.302891, -0.366401, 0.223978, 1, 0, 0, 1, 0.01308494,
-0.13439, 0.026074, -0.004612, 1, 0, 0, 1, 0.01308494,
-0.048095, 0.174566, 0.110808, 1, 0, 0, 1, 0.01308494,
-0.155746, 0.113338, -0.139707, 1, 0, 0, 1, 0.01308494,
-0.135734, 0.179207, -0.167489, 1, 0, 0, 1, 0.01308494,
-0.429802, 0.131117, 0.358072, 1, 0, 0, 1, 0.01308494,
-0.468304, -0.048482, 0.122787, 1, 0, 0, 1, 0.01308494,
-0.423695, -0.071916, 0.043612, 1, 0, 0, 1, 0.01308494,
-0.25106, 0.21411, 0.023776, 1, 0, 0, 1, 0.01308494,
-0.016962, 0.103268, 0.170178, 1, 0, 0, 1, 0.01308494,
-0.162603, 0.09689, -0.120982, 1, 0, 0, 1, 0.01308494,
-0.039214, 0.056984, -0.007596, 1, 0, 0, 1, 0.01308494,
-0.037997, 0.043611, 0.249274, 1, 0, 0, 1, 0.01308494,
-0.278551, 0.000694, 0.046631, 1, 0, 0, 1, 0.01308494,
-0.211734, 0.211208, 0.10085, 1, 0, 0, 1, 0.01308494,
-0.165453, 0.181786, -0.006224, 1, 0, 0, 1, 0.01308494,
-0.124434, 0.165239, -0.167872, 1, 0, 0, 1, 0.01308494,
-0.375081, 0.028898, 0.234312, 1, 0, 0, 1, 0.01308494,
-0.339903, 0.121514, 0.099461, 1, 0, 0, 1, 0.01308494,
-0.338696, 0.106578, -0.055343, 1, 0, 0, 1, 0.01308494,
-0.361882, 0.022513, 0.135605, 1, 0, 0, 1, 0.01308494,
-0.071693, 0.16392, -0.200685, 1, 0, 0, 1, 0.01308494,
-0.097943, 0.116971, -0.043692, 1, 0, 0, 1, 0.01308494,
-0.219046, 0.070712, 0.096805, 1, 0, 0, 1, 0.01308494,
-0.197289, -0.045588, 0.045246, 1, 0, 0, 1, 0.01308494,
-0.007349, 0.192789, 0.021894, 1, 0, 0, 1, 0.01308494,
-0.290536, 0.02072, 0.104257, 1, 0, 0, 1, 0.01308494,
-0.298565, -0.156753, -0.044449, 1, 0, 0, 1, 0.01308494,
-0.433522, -0.012349, 0.275014, 1, 0, 0, 1, 0.01308494,
-0.435809, 0.010703, 0.11607, 1, 0, 0, 1, 0.01308494,
-0.23544, 0.291287, 0.029007, 1, 0, 0, 1, 0.01308494,
0.090266, 0.061051, 0.220721, 1, 0, 0, 1, 0.01308494,
-0.115822, 0.121189, -0.120839, 1, 0, 0, 1, 0.01308494,
-0.371097, -0.353952, 0.125975, 1, 0, 0, 1, 0.01308494,
-0.189007, -0.106168, 0.154363, 1, 0, 0, 1, 0.01308494,
-0.275788, -0.015648, 0.032217, 1, 0, 0, 1, 0.01308494,
-0.328654, -0.250094, -0.014559, 1, 0, 0, 1, 0.01308494,
-0.349333, 0.019791, 0.030253, 1, 0, 0, 1, 0.01308494,
-0.437346, -0.025391, 0.043315, 1, 0, 0, 1, 0.01308494,
-0.370008, 0.109976, 0.013169, 1, 0, 0, 1, 0.01308494,
-0.355657, 0.183744, 0.281239, 1, 0, 0, 1, 0.01308494,
-0.152533, 0.164984, -0.075476, 1, 0, 0, 1, 0.01308494,
-0.047491, 0.026877, 0.030154, 1, 0, 0, 1, 0.01308494,
-0.278857, -0.066333, 0.063187, 1, 0, 0, 1, 0.01308494,
-0.255312, -0.023908, 0.072347, 1, 0, 0, 1, 0.01308494,
-0.176737, 0.193261, 0.133541, 1, 0, 0, 1, 0.01308494,
0.090002, -0.106525, 0.027678, 0, 0, 1, 1, 0.01308494,
0.028381, -0.072966, -0.092445, 0, 0, 1, 1, 0.01308494,
0.091061, -0.092944, 0.117845, 0, 0, 1, 1, 0.01308494,
0.159422, -0.044981, 0.111452, 0, 0, 1, 1, 0.01308494,
0.16154, 0.010294, 0.025764, 0, 0, 1, 1, 0.01308494,
0.220361, -0.064145, -0.001906, 0, 0, 1, 1, 0.01308494,
0.160273, -0.00784, 0.134799, 0, 0, 1, 1, 0.01308494,
0.221941, 0.003868, 0.025284, 0, 0, 1, 1, 0.01308494,
0.206183, -0.011445, 0.099141, 0, 0, 1, 1, 0.01308494,
-0.101416, -0.145012, -0.014236, 0, 0, 1, 1, 0.01308494,
0.213947, -0.006979, 0.066267, 0, 0, 1, 1, 0.01308494,
0.219144, 0.082632, 0.02445, 0, 0, 1, 1, 0.01308494,
0.126338, 0.101011, -0.029188, 0, 0, 1, 1, 0.01308494,
0.18562, 0.045945, 0.064385, 0, 0, 1, 1, 0.01308494,
0.262711, -0.030136, 0.002102, 0, 0, 1, 1, 0.01308494,
0.217412, 0.026219, -0.030265, 0, 0, 1, 1, 0.01308494,
0.31818, -0.045089, 0.039653, 0, 0, 1, 1, 0.01308494,
0.202944, -0.064053, 0.009858, 0, 0, 1, 1, 0.01308494,
0.227171, 0.03733, 0.013075, 0, 0, 1, 1, 0.01308494,
0.192553, 0.056049, 0.056771, 0, 0, 1, 1, 0.01308494,
0.164844, -0.081293, -0.037613, 0, 0, 1, 1, 0.01308494,
0.171486, 0.01696, -0.028226, 0, 0, 1, 1, 0.01308494,
0.205906, 0.120598, -0.033278, 0, 0, 1, 1, 0.01308494,
0.150598, 0.167943, -0.040856, 0, 0, 1, 1, 0.01308494,
0.132819, 0.042804, 0.041344, 0, 0, 1, 1, 0.01308494,
0.282918, 0.07295, -0.010304, 0, 0, 1, 1, 0.01308494,
0.246211, 0.044757, -0.065616, 0, 0, 1, 1, 0.01308494,
0.264016, -0.020484, 0.038768, 0, 0, 1, 1, 0.01308494,
0.10756, -0.107151, 0.117049, 0, 0, 1, 1, 0.01308494,
0.144846, -0.19355, 0.053439, 0, 0, 1, 1, 0.01308494,
0.209978, 0.019127, -0.039405, 0, 0, 1, 1, 0.01308494,
0.146704, 0.004026, -0.07985, 0, 0, 1, 1, 0.01308494,
0.100775, -0.126714, 0.029737, 0, 0, 1, 1, 0.01308494,
0.192055, -0.022148, -0.049405, 0, 0, 1, 1, 0.01308494,
0.13976, 0.121608, -0.041182, 0, 0, 1, 1, 0.01308494,
0.095417, -0.22346, 0.126924, 0, 0, 1, 1, 0.01308494,
0.292849, -0.082411, -0.036618, 0, 0, 1, 1, 0.01308494,
0.30509, -0.002154, -0.017089, 0, 0, 1, 1, 0.01308494,
0.282935, -0.112016, 0.040939, 0, 0, 1, 1, 0.01308494,
0.135044, -0.130472, 0.063384, 0, 0, 1, 1, 0.01308494,
0.146172, -0.130217, 0.015727, 0, 0, 1, 1, 0.01308494,
0.02357, -0.129889, 0.14869, 0, 0, 1, 1, 0.01308494,
0.154119, 0.054639, 0.000159, 0, 0, 1, 1, 0.01308494,
0.115075, -0.128813, -0.094463, 0, 0, 1, 1, 0.01308494,
0.11212, 0.100961, 0.008125, 0, 0, 1, 1, 0.01308494,
0.155959, 0.01513, -0.094887, 0, 0, 1, 1, 0.01308494,
0.19411, 0.070856, 0.010587, 0, 0, 1, 1, 0.01308494,
0.255735, -0.03661, -0.102679, 0, 0, 1, 1, 0.01308494,
0.288298, -0.032727, -0.012742, 0, 0, 1, 1, 0.01308494,
0.278629, -0.064341, 0.068421, 0, 0, 1, 1, 0.01308494,
0.158071, -0.21104, 0.021644, 0, 0, 1, 1, 0.01308494,
0.077903, -0.188171, 0.098808, 0, 0, 1, 1, 0.01308494,
0.199008, -0.082276, -0.014101, 0, 0, 1, 1, 0.01308494,
0.023149, 0.088211, 0.056097, 0, 0, 1, 1, 0.01308494,
0.13842, -0.049342, -0.023989, 0, 0, 1, 1, 0.01308494,
0.175625, 0.081521, -0.012865, 0, 0, 1, 1, 0.01308494,
0.126177, -0.002209, -0.152164, 0, 0, 1, 1, 0.01308494,
0.206745, 0.017484, 0.003233, 0, 0, 1, 1, 0.01308494,
0.356259, -0.073824, 0.045822, 0, 0, 1, 1, 0.01308494,
0.266222, -0.001966, 0.022855, 0, 0, 1, 1, 0.01308494,
0.187581, -0.076627, 0.017387, 0, 0, 1, 1, 0.01308494,
0.200376, -0.060337, -0.041454, 0, 0, 1, 1, 0.01308494,
0.080707, -0.20497, 0.033135, 0, 0, 1, 1, 0.01308494,
0.202297, 0.038879, -0.053093, 0, 0, 1, 1, 0.01308494,
0.21772, -0.119369, -0.002696, 0, 0, 1, 1, 0.01308494,
0.17307, 0.132312, 0.017951, 0, 0, 1, 1, 0.01308494,
0.144183, -0.062509, -0.087643, 0, 0, 1, 1, 0.01308494,
0.096602, -0.070512, -0.042726, 0, 0, 1, 1, 0.01308494,
0.159485, 0.003783, -0.046585, 0, 0, 1, 1, 0.01308494,
0.284733, 0.040431, -0.009522, 0, 0, 1, 1, 0.01308494,
0.331901, -0.0521, -0.002445, 0, 0, 1, 1, 0.01308494,
0.176308, -0.162551, 0.059687, 0, 0, 1, 1, 0.01308494,
0.224918, -0.096582, -0.02942, 0, 0, 1, 1, 0.01308494,
0.120907, -0.187356, 0.098106, 0, 0, 1, 1, 0.01308494,
0.167561, -0.074004, 0.070567, 0, 0, 1, 1, 0.01308494,
0.170654, -0.068615, -0.02069, 0, 0, 1, 1, 0.01308494,
0.157133, 0.06728, -0.006428, 0, 0, 1, 1, 0.01308494,
0.162535, -0.116164, -0.077371, 0, 0, 1, 1, 0.01308494,
0.193616, -0.018315, -0.010747, 0, 0, 1, 1, 0.01308494,
0.093196, -0.136778, 0.10728, 0, 0, 1, 1, 0.01308494,
0.261858, -0.07325, -0.02534, 0, 0, 1, 1, 0.01308494,
0.267426, 0.011032, -0.044151, 0, 0, 1, 1, 0.01308494,
0.138376, -0.178019, -0.03778, 0, 0, 1, 1, 0.01308494,
0.10089, -0.179142, 0.101535, 0, 0, 1, 1, 0.01308494,
0.087986, -0.09613, 0.012577, 0, 0, 1, 1, 0.01308494,
0.077781, 0.028736, 0.077778, 0, 0, 1, 1, 0.01308494,
0.172924, 0.085897, 0.01648, 0, 0, 1, 1, 0.01308494,
0.194783, 0.03996, 0.072281, 0, 0, 1, 1, 0.01308494,
0.084152, -0.024205, 0.147963, 0, 0, 1, 1, 0.01308494,
0.317998, -0.016913, 0.031672, 0, 0, 1, 1, 0.01308494,
0.201819, 0.063647, 0.042197, 0, 0, 1, 1, 0.01308494,
0.197513, -0.00267, -0.001566, 0, 0, 1, 1, 0.01308494,
0.067809, -0.242666, 0.169154, 0, 0, 1, 1, 0.01308494,
0.109059, -0.092098, -0.032984, 0, 0, 1, 1, 0.01308494,
0.033104, -0.078175, -0.054937, 0, 0, 1, 1, 0.01308494,
0.131795, -0.065255, 0.056698, 0, 0, 1, 1, 0.01308494,
0.068448, -0.040864, 0.101244, 0, 0, 1, 1, 0.01308494,
0.157213, 0.05653, 0.020425, 0, 0, 1, 1, 0.01308494,
0.142794, -0.090698, -0.058751, 0, 0, 1, 1, 0.01308494,
0.279124, 0.044499, -0.023639, 0, 0, 1, 1, 0.01308494,
0.259054, -0.027535, -0.012347, 0, 0, 1, 1, 0.01308494,
0.17029, -0.169075, -0.025571, 0, 0, 1, 1, 0.01308494,
0.206317, -0.049336, 0.096799, 0, 0, 1, 1, 0.01308494
]);
var values7 = v;
var normLoc7 = gl.getAttribLocation(prog7, "aNorm");
var mvMatLoc7 = gl.getUniformLocation(prog7,"mvMatrix");
var prMatLoc7 = gl.getUniformLocation(prog7,"prMatrix");
var normMatLoc7 = gl.getUniformLocation(prog7,"normMatrix");
// ****** text object 9 ******
var prog9  = gl.createProgram();
gl.attachShader(prog9, getShader( gl, "unnamed_chunk_1vshader9" ));
gl.attachShader(prog9, getShader( gl, "unnamed_chunk_1fshader9" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog9, 0, "aPos");
gl.bindAttribLocation(prog9, 1, "aCol");
gl.linkProgram(prog9);
var texts = [
"Axis 1"
];
var texinfo = drawTextToCanvas(texts, 1);	 
var canvasX9 = texinfo.canvasX;
var canvasY9 = texinfo.canvasY;
var ofsLoc9 = gl.getAttribLocation(prog9, "aOfs");
var texture9 = gl.createTexture();
var texLoc9 = gl.getAttribLocation(prog9, "aTexcoord");
var sampler9 = gl.getUniformLocation(prog9,"uSampler");
handleLoadedTexture(texture9, document.getElementById("unnamed_chunk_1textureCanvas"));
var v=new Float32Array([
-0.0649375, -0.6043475, -0.469914, 0, -0.5, 0.5, 0.5,
-0.0649375, -0.6043475, -0.469914, 1, -0.5, 0.5, 0.5,
-0.0649375, -0.6043475, -0.469914, 1, 1.5, 0.5, 0.5,
-0.0649375, -0.6043475, -0.469914, 0, 1.5, 0.5, 0.5
]);
for (var i=0; i<1; i++) 
for (var j=0; j<4; j++) {
var ind = 7*(4*i + j) + 3;
v[ind+2] = 2*(v[ind]-v[ind+2])*texinfo.widths[i];
v[ind+3] = 2*(v[ind+1]-v[ind+3])*texinfo.textHeight;
v[ind] *= texinfo.widths[i]/texinfo.canvasX;
v[ind+1] = 1.0-(texinfo.offset + i*texinfo.skip 
- v[ind+1]*texinfo.textHeight)/texinfo.canvasY;
}
var f=new Uint16Array([
0, 1, 2, 0, 2, 3
]);
var buf9 = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf9);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var ibuf9 = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf9);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.STATIC_DRAW);
var mvMatLoc9 = gl.getUniformLocation(prog9,"mvMatrix");
var prMatLoc9 = gl.getUniformLocation(prog9,"prMatrix");
var textScaleLoc9 = gl.getUniformLocation(prog9,"textScale");
// ****** text object 10 ******
var prog10  = gl.createProgram();
gl.attachShader(prog10, getShader( gl, "unnamed_chunk_1vshader10" ));
gl.attachShader(prog10, getShader( gl, "unnamed_chunk_1fshader10" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog10, 0, "aPos");
gl.bindAttribLocation(prog10, 1, "aCol");
gl.linkProgram(prog10);
var texts = [
"Axis 2"
];
var texinfo = drawTextToCanvas(texts, 1);	 
var canvasX10 = texinfo.canvasX;
var canvasY10 = texinfo.canvasY;
var ofsLoc10 = gl.getAttribLocation(prog10, "aOfs");
var texture10 = gl.createTexture();
var texLoc10 = gl.getAttribLocation(prog10, "aTexcoord");
var sampler10 = gl.getUniformLocation(prog10,"uSampler");
handleLoadedTexture(texture10, document.getElementById("unnamed_chunk_1textureCanvas"));
var v=new Float32Array([
-0.647719, -0.04365151, -0.469914, 0, -0.5, 0.5, 0.5,
-0.647719, -0.04365151, -0.469914, 1, -0.5, 0.5, 0.5,
-0.647719, -0.04365151, -0.469914, 1, 1.5, 0.5, 0.5,
-0.647719, -0.04365151, -0.469914, 0, 1.5, 0.5, 0.5
]);
for (var i=0; i<1; i++) 
for (var j=0; j<4; j++) {
var ind = 7*(4*i + j) + 3;
v[ind+2] = 2*(v[ind]-v[ind+2])*texinfo.widths[i];
v[ind+3] = 2*(v[ind+1]-v[ind+3])*texinfo.textHeight;
v[ind] *= texinfo.widths[i]/texinfo.canvasX;
v[ind+1] = 1.0-(texinfo.offset + i*texinfo.skip 
- v[ind+1]*texinfo.textHeight)/texinfo.canvasY;
}
var f=new Uint16Array([
0, 1, 2, 0, 2, 3
]);
var buf10 = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf10);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var ibuf10 = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf10);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.STATIC_DRAW);
var mvMatLoc10 = gl.getUniformLocation(prog10,"mvMatrix");
var prMatLoc10 = gl.getUniformLocation(prog10,"prMatrix");
var textScaleLoc10 = gl.getUniformLocation(prog10,"textScale");
// ****** text object 11 ******
var prog11  = gl.createProgram();
gl.attachShader(prog11, getShader( gl, "unnamed_chunk_1vshader11" ));
gl.attachShader(prog11, getShader( gl, "unnamed_chunk_1fshader11" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog11, 0, "aPos");
gl.bindAttribLocation(prog11, 1, "aCol");
gl.linkProgram(prog11);
var texts = [
"Axis 3"
];
var texinfo = drawTextToCanvas(texts, 1);	 
var canvasX11 = texinfo.canvasX;
var canvasY11 = texinfo.canvasY;
var ofsLoc11 = gl.getAttribLocation(prog11, "aOfs");
var texture11 = gl.createTexture();
var texLoc11 = gl.getAttribLocation(prog11, "aTexcoord");
var sampler11 = gl.getUniformLocation(prog11,"uSampler");
handleLoadedTexture(texture11, document.getElementById("unnamed_chunk_1textureCanvas"));
var v=new Float32Array([
-0.647719, -0.6043475, 0.010709, 0, -0.5, 0.5, 0.5,
-0.647719, -0.6043475, 0.010709, 1, -0.5, 0.5, 0.5,
-0.647719, -0.6043475, 0.010709, 1, 1.5, 0.5, 0.5,
-0.647719, -0.6043475, 0.010709, 0, 1.5, 0.5, 0.5
]);
for (var i=0; i<1; i++) 
for (var j=0; j<4; j++) {
var ind = 7*(4*i + j) + 3;
v[ind+2] = 2*(v[ind]-v[ind+2])*texinfo.widths[i];
v[ind+3] = 2*(v[ind+1]-v[ind+3])*texinfo.textHeight;
v[ind] *= texinfo.widths[i]/texinfo.canvasX;
v[ind+1] = 1.0-(texinfo.offset + i*texinfo.skip 
- v[ind+1]*texinfo.textHeight)/texinfo.canvasY;
}
var f=new Uint16Array([
0, 1, 2, 0, 2, 3
]);
var buf11 = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf11);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var ibuf11 = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf11);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.STATIC_DRAW);
var mvMatLoc11 = gl.getUniformLocation(prog11,"mvMatrix");
var prMatLoc11 = gl.getUniformLocation(prog11,"prMatrix");
var textScaleLoc11 = gl.getUniformLocation(prog11,"textScale");
// ****** lines object 12 ******
var prog12  = gl.createProgram();
gl.attachShader(prog12, getShader( gl, "unnamed_chunk_1vshader12" ));
gl.attachShader(prog12, getShader( gl, "unnamed_chunk_1fshader12" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog12, 0, "aPos");
gl.bindAttribLocation(prog12, 1, "aCol");
gl.linkProgram(prog12);
var v=new Float32Array([
-0.4, -0.4749561, -0.359001,
0.2, -0.4749561, -0.359001,
-0.4, -0.4749561, -0.359001,
-0.4, -0.4965213, -0.3774865,
-0.2, -0.4749561, -0.359001,
-0.2, -0.4965213, -0.3774865,
0, -0.4749561, -0.359001,
0, -0.4965213, -0.3774865,
0.2, -0.4749561, -0.359001,
0.2, -0.4965213, -0.3774865
]);
var buf12 = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf12);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var mvMatLoc12 = gl.getUniformLocation(prog12,"mvMatrix");
var prMatLoc12 = gl.getUniformLocation(prog12,"prMatrix");
// ****** text object 13 ******
var prog13  = gl.createProgram();
gl.attachShader(prog13, getShader( gl, "unnamed_chunk_1vshader13" ));
gl.attachShader(prog13, getShader( gl, "unnamed_chunk_1fshader13" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog13, 0, "aPos");
gl.bindAttribLocation(prog13, 1, "aCol");
gl.linkProgram(prog13);
var texts = [
"-0.4",
"-0.2",
"0",
"0.2"
];
var texinfo = drawTextToCanvas(texts, 1);	 
var canvasX13 = texinfo.canvasX;
var canvasY13 = texinfo.canvasY;
var ofsLoc13 = gl.getAttribLocation(prog13, "aOfs");
var texture13 = gl.createTexture();
var texLoc13 = gl.getAttribLocation(prog13, "aTexcoord");
var sampler13 = gl.getUniformLocation(prog13,"uSampler");
handleLoadedTexture(texture13, document.getElementById("unnamed_chunk_1textureCanvas"));
var v=new Float32Array([
-0.4, -0.5396518, -0.4144575, 0, -0.5, 0.5, 0.5,
-0.4, -0.5396518, -0.4144575, 1, -0.5, 0.5, 0.5,
-0.4, -0.5396518, -0.4144575, 1, 1.5, 0.5, 0.5,
-0.4, -0.5396518, -0.4144575, 0, 1.5, 0.5, 0.5,
-0.2, -0.5396518, -0.4144575, 0, -0.5, 0.5, 0.5,
-0.2, -0.5396518, -0.4144575, 1, -0.5, 0.5, 0.5,
-0.2, -0.5396518, -0.4144575, 1, 1.5, 0.5, 0.5,
-0.2, -0.5396518, -0.4144575, 0, 1.5, 0.5, 0.5,
0, -0.5396518, -0.4144575, 0, -0.5, 0.5, 0.5,
0, -0.5396518, -0.4144575, 1, -0.5, 0.5, 0.5,
0, -0.5396518, -0.4144575, 1, 1.5, 0.5, 0.5,
0, -0.5396518, -0.4144575, 0, 1.5, 0.5, 0.5,
0.2, -0.5396518, -0.4144575, 0, -0.5, 0.5, 0.5,
0.2, -0.5396518, -0.4144575, 1, -0.5, 0.5, 0.5,
0.2, -0.5396518, -0.4144575, 1, 1.5, 0.5, 0.5,
0.2, -0.5396518, -0.4144575, 0, 1.5, 0.5, 0.5
]);
for (var i=0; i<4; i++) 
for (var j=0; j<4; j++) {
var ind = 7*(4*i + j) + 3;
v[ind+2] = 2*(v[ind]-v[ind+2])*texinfo.widths[i];
v[ind+3] = 2*(v[ind+1]-v[ind+3])*texinfo.textHeight;
v[ind] *= texinfo.widths[i]/texinfo.canvasX;
v[ind+1] = 1.0-(texinfo.offset + i*texinfo.skip 
- v[ind+1]*texinfo.textHeight)/texinfo.canvasY;
}
var f=new Uint16Array([
0, 1, 2, 0, 2, 3,
4, 5, 6, 4, 6, 7,
8, 9, 10, 8, 10, 11,
12, 13, 14, 12, 14, 15
]);
var buf13 = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf13);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var ibuf13 = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf13);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.STATIC_DRAW);
var mvMatLoc13 = gl.getUniformLocation(prog13,"mvMatrix");
var prMatLoc13 = gl.getUniformLocation(prog13,"prMatrix");
var textScaleLoc13 = gl.getUniformLocation(prog13,"textScale");
// ****** lines object 14 ******
var prog14  = gl.createProgram();
gl.attachShader(prog14, getShader( gl, "unnamed_chunk_1vshader14" ));
gl.attachShader(prog14, getShader( gl, "unnamed_chunk_1fshader14" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog14, 0, "aPos");
gl.bindAttribLocation(prog14, 1, "aCol");
gl.linkProgram(prog14);
var v=new Float32Array([
-0.513231, -0.4, -0.359001,
-0.513231, 0.2, -0.359001,
-0.513231, -0.4, -0.359001,
-0.5356456, -0.4, -0.3774865,
-0.513231, -0.2, -0.359001,
-0.5356456, -0.2, -0.3774865,
-0.513231, 0, -0.359001,
-0.5356456, 0, -0.3774865,
-0.513231, 0.2, -0.359001,
-0.5356456, 0.2, -0.3774865
]);
var buf14 = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf14);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var mvMatLoc14 = gl.getUniformLocation(prog14,"mvMatrix");
var prMatLoc14 = gl.getUniformLocation(prog14,"prMatrix");
// ****** text object 15 ******
var prog15  = gl.createProgram();
gl.attachShader(prog15, getShader( gl, "unnamed_chunk_1vshader15" ));
gl.attachShader(prog15, getShader( gl, "unnamed_chunk_1fshader15" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog15, 0, "aPos");
gl.bindAttribLocation(prog15, 1, "aCol");
gl.linkProgram(prog15);
var texts = [
"-0.4",
"-0.2",
"0",
"0.2"
];
var texinfo = drawTextToCanvas(texts, 1);	 
var canvasX15 = texinfo.canvasX;
var canvasY15 = texinfo.canvasY;
var ofsLoc15 = gl.getAttribLocation(prog15, "aOfs");
var texture15 = gl.createTexture();
var texLoc15 = gl.getAttribLocation(prog15, "aTexcoord");
var sampler15 = gl.getUniformLocation(prog15,"uSampler");
handleLoadedTexture(texture15, document.getElementById("unnamed_chunk_1textureCanvas"));
var v=new Float32Array([
-0.580475, -0.4, -0.4144575, 0, -0.5, 0.5, 0.5,
-0.580475, -0.4, -0.4144575, 1, -0.5, 0.5, 0.5,
-0.580475, -0.4, -0.4144575, 1, 1.5, 0.5, 0.5,
-0.580475, -0.4, -0.4144575, 0, 1.5, 0.5, 0.5,
-0.580475, -0.2, -0.4144575, 0, -0.5, 0.5, 0.5,
-0.580475, -0.2, -0.4144575, 1, -0.5, 0.5, 0.5,
-0.580475, -0.2, -0.4144575, 1, 1.5, 0.5, 0.5,
-0.580475, -0.2, -0.4144575, 0, 1.5, 0.5, 0.5,
-0.580475, 0, -0.4144575, 0, -0.5, 0.5, 0.5,
-0.580475, 0, -0.4144575, 1, -0.5, 0.5, 0.5,
-0.580475, 0, -0.4144575, 1, 1.5, 0.5, 0.5,
-0.580475, 0, -0.4144575, 0, 1.5, 0.5, 0.5,
-0.580475, 0.2, -0.4144575, 0, -0.5, 0.5, 0.5,
-0.580475, 0.2, -0.4144575, 1, -0.5, 0.5, 0.5,
-0.580475, 0.2, -0.4144575, 1, 1.5, 0.5, 0.5,
-0.580475, 0.2, -0.4144575, 0, 1.5, 0.5, 0.5
]);
for (var i=0; i<4; i++) 
for (var j=0; j<4; j++) {
var ind = 7*(4*i + j) + 3;
v[ind+2] = 2*(v[ind]-v[ind+2])*texinfo.widths[i];
v[ind+3] = 2*(v[ind+1]-v[ind+3])*texinfo.textHeight;
v[ind] *= texinfo.widths[i]/texinfo.canvasX;
v[ind+1] = 1.0-(texinfo.offset + i*texinfo.skip 
- v[ind+1]*texinfo.textHeight)/texinfo.canvasY;
}
var f=new Uint16Array([
0, 1, 2, 0, 2, 3,
4, 5, 6, 4, 6, 7,
8, 9, 10, 8, 10, 11,
12, 13, 14, 12, 14, 15
]);
var buf15 = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf15);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var ibuf15 = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf15);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.STATIC_DRAW);
var mvMatLoc15 = gl.getUniformLocation(prog15,"mvMatrix");
var prMatLoc15 = gl.getUniformLocation(prog15,"prMatrix");
var textScaleLoc15 = gl.getUniformLocation(prog15,"textScale");
// ****** lines object 16 ******
var prog16  = gl.createProgram();
gl.attachShader(prog16, getShader( gl, "unnamed_chunk_1vshader16" ));
gl.attachShader(prog16, getShader( gl, "unnamed_chunk_1fshader16" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog16, 0, "aPos");
gl.bindAttribLocation(prog16, 1, "aCol");
gl.linkProgram(prog16);
var v=new Float32Array([
-0.513231, -0.4749561, -0.2,
-0.513231, -0.4749561, 0.2,
-0.513231, -0.4749561, -0.2,
-0.5356456, -0.4965213, -0.2,
-0.513231, -0.4749561, 0,
-0.5356456, -0.4965213, 0,
-0.513231, -0.4749561, 0.2,
-0.5356456, -0.4965213, 0.2
]);
var buf16 = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf16);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var mvMatLoc16 = gl.getUniformLocation(prog16,"mvMatrix");
var prMatLoc16 = gl.getUniformLocation(prog16,"prMatrix");
// ****** text object 17 ******
var prog17  = gl.createProgram();
gl.attachShader(prog17, getShader( gl, "unnamed_chunk_1vshader17" ));
gl.attachShader(prog17, getShader( gl, "unnamed_chunk_1fshader17" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog17, 0, "aPos");
gl.bindAttribLocation(prog17, 1, "aCol");
gl.linkProgram(prog17);
var texts = [
"-0.2",
"0",
"0.2"
];
var texinfo = drawTextToCanvas(texts, 1);	 
var canvasX17 = texinfo.canvasX;
var canvasY17 = texinfo.canvasY;
var ofsLoc17 = gl.getAttribLocation(prog17, "aOfs");
var texture17 = gl.createTexture();
var texLoc17 = gl.getAttribLocation(prog17, "aTexcoord");
var sampler17 = gl.getUniformLocation(prog17,"uSampler");
handleLoadedTexture(texture17, document.getElementById("unnamed_chunk_1textureCanvas"));
var v=new Float32Array([
-0.580475, -0.5396518, -0.2, 0, -0.5, 0.5, 0.5,
-0.580475, -0.5396518, -0.2, 1, -0.5, 0.5, 0.5,
-0.580475, -0.5396518, -0.2, 1, 1.5, 0.5, 0.5,
-0.580475, -0.5396518, -0.2, 0, 1.5, 0.5, 0.5,
-0.580475, -0.5396518, 0, 0, -0.5, 0.5, 0.5,
-0.580475, -0.5396518, 0, 1, -0.5, 0.5, 0.5,
-0.580475, -0.5396518, 0, 1, 1.5, 0.5, 0.5,
-0.580475, -0.5396518, 0, 0, 1.5, 0.5, 0.5,
-0.580475, -0.5396518, 0.2, 0, -0.5, 0.5, 0.5,
-0.580475, -0.5396518, 0.2, 1, -0.5, 0.5, 0.5,
-0.580475, -0.5396518, 0.2, 1, 1.5, 0.5, 0.5,
-0.580475, -0.5396518, 0.2, 0, 1.5, 0.5, 0.5
]);
for (var i=0; i<3; i++) 
for (var j=0; j<4; j++) {
var ind = 7*(4*i + j) + 3;
v[ind+2] = 2*(v[ind]-v[ind+2])*texinfo.widths[i];
v[ind+3] = 2*(v[ind+1]-v[ind+3])*texinfo.textHeight;
v[ind] *= texinfo.widths[i]/texinfo.canvasX;
v[ind+1] = 1.0-(texinfo.offset + i*texinfo.skip 
- v[ind+1]*texinfo.textHeight)/texinfo.canvasY;
}
var f=new Uint16Array([
0, 1, 2, 0, 2, 3,
4, 5, 6, 4, 6, 7,
8, 9, 10, 8, 10, 11
]);
var buf17 = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf17);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var ibuf17 = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf17);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.STATIC_DRAW);
var mvMatLoc17 = gl.getUniformLocation(prog17,"mvMatrix");
var prMatLoc17 = gl.getUniformLocation(prog17,"prMatrix");
var textScaleLoc17 = gl.getUniformLocation(prog17,"textScale");
// ****** lines object 18 ******
var prog18  = gl.createProgram();
gl.attachShader(prog18, getShader( gl, "unnamed_chunk_1vshader18" ));
gl.attachShader(prog18, getShader( gl, "unnamed_chunk_1fshader18" ));
//  Force aPos to location 0, aCol to location 1 
gl.bindAttribLocation(prog18, 0, "aPos");
gl.bindAttribLocation(prog18, 1, "aCol");
gl.linkProgram(prog18);
var v=new Float32Array([
-0.513231, -0.4749561, -0.359001,
-0.513231, 0.3876531, -0.359001,
-0.513231, -0.4749561, 0.380419,
-0.513231, 0.3876531, 0.380419,
-0.513231, -0.4749561, -0.359001,
-0.513231, -0.4749561, 0.380419,
-0.513231, 0.3876531, -0.359001,
-0.513231, 0.3876531, 0.380419,
-0.513231, -0.4749561, -0.359001,
0.3833559, -0.4749561, -0.359001,
-0.513231, -0.4749561, 0.380419,
0.3833559, -0.4749561, 0.380419,
-0.513231, 0.3876531, -0.359001,
0.3833559, 0.3876531, -0.359001,
-0.513231, 0.3876531, 0.380419,
0.3833559, 0.3876531, 0.380419,
0.3833559, -0.4749561, -0.359001,
0.3833559, 0.3876531, -0.359001,
0.3833559, -0.4749561, 0.380419,
0.3833559, 0.3876531, 0.380419,
0.3833559, -0.4749561, -0.359001,
0.3833559, -0.4749561, 0.380419,
0.3833559, 0.3876531, -0.359001,
0.3833559, 0.3876531, 0.380419
]);
var buf18 = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buf18);
gl.bufferData(gl.ARRAY_BUFFER, v, gl.STATIC_DRAW);
var mvMatLoc18 = gl.getUniformLocation(prog18,"mvMatrix");
var prMatLoc18 = gl.getUniformLocation(prog18,"prMatrix");
gl.enable(gl.DEPTH_TEST);
gl.depthFunc(gl.LEQUAL);
gl.clearDepth(1.0);
gl.clearColor(1,1,1,1);
var xOffs = 0, yOffs = 0, drag  = 0;
function multMV(M, v) {
return [M.m11*v[0] + M.m12*v[1] + M.m13*v[2] + M.m14*v[3],
M.m21*v[0] + M.m22*v[1] + M.m23*v[2] + M.m24*v[3],
M.m31*v[0] + M.m32*v[1] + M.m33*v[2] + M.m34*v[3],
M.m41*v[0] + M.m42*v[1] + M.m43*v[2] + M.m44*v[3]];
}
drawScene();
function drawScene(){
gl.depthMask(true);
gl.disable(gl.BLEND);
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
// ***** subscene 1 ****
gl.viewport(0, 0, 504, 504);
gl.scissor(0, 0, 504, 504);
gl.clearColor(1, 1, 1, 1);
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
var radius = 0.7728352;
var distance = 3.438431;
var t = tan(fov[1]*PI/360);
var near = distance - radius;
var far = distance + radius;
var hlen = t*near;
var aspect = 1;
prMatrix.makeIdentity();
if (aspect > 1)
prMatrix.frustum(-hlen*aspect*zoom[1], hlen*aspect*zoom[1], 
-hlen*zoom[1], hlen*zoom[1], near, far);
else  
prMatrix.frustum(-hlen*zoom[1], hlen*zoom[1], 
-hlen*zoom[1]/aspect, hlen*zoom[1]/aspect, 
near, far);
mvMatrix.makeIdentity();
mvMatrix.translate( 0.0649375, 0.04365151, -0.010709 );
mvMatrix.scale( 0.9319838, 0.9686942, 1.130081 );   
mvMatrix.multRight( userMatrix[1] );
mvMatrix.translate(-0, -0, -3.438431);
normMatrix.makeIdentity();
normMatrix.scale( 1.07298, 1.032318, 0.8848924 );   
normMatrix.multRight( userMatrix[1] );
// ****** spheres object 7 *******
gl.useProgram(prog7);
gl.bindBuffer(gl.ARRAY_BUFFER, sphereBuf);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, sphereIbuf);
gl.uniformMatrix4fv( prMatLoc7, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc7, false, new Float32Array(mvMatrix.getAsArray()) );
gl.uniformMatrix4fv( normMatLoc7, false, new Float32Array(normMatrix.getAsArray()) );
gl.enableVertexAttribArray( posLoc );
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 12,  0);
gl.enableVertexAttribArray(normLoc7 );
gl.vertexAttribPointer(normLoc7,  3, gl.FLOAT, false, 12,  0);
gl.disableVertexAttribArray( colLoc );
var sphereNorm = new CanvasMatrix4();
sphereNorm.scale(0.9319838, 0.9686942, 1.130081);
sphereNorm.multRight(normMatrix);
gl.uniformMatrix4fv( normMatLoc7, false, new Float32Array(sphereNorm.getAsArray()) );
for (var i = 0; i < 210; i++) {
var sphereMV = new CanvasMatrix4();
var baseofs = i*8
var ofs = baseofs + 7;	       
var scale = values7[ofs];
sphereMV.scale(1.07298*scale, 1.032318*scale, 0.8848924*scale);
sphereMV.translate(values7[baseofs], 
values7[baseofs+1], 
values7[baseofs+2]);
sphereMV.multRight(mvMatrix);
gl.uniformMatrix4fv( mvMatLoc7, false, new Float32Array(sphereMV.getAsArray()) );
ofs = baseofs + 3;       
gl.vertexAttrib4f( colLoc, values7[ofs], 
values7[ofs+1], 
values7[ofs+2],
values7[ofs+3] );
gl.drawElements(gl.TRIANGLES, 384, gl.UNSIGNED_SHORT, 0);
}
// ****** text object 9 *******
gl.useProgram(prog9);
gl.bindBuffer(gl.ARRAY_BUFFER, buf9);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf9);
gl.uniformMatrix4fv( prMatLoc9, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc9, false, new Float32Array(mvMatrix.getAsArray()) );
gl.uniform2f( textScaleLoc9, 0.001488095, 0.001488095);
gl.enableVertexAttribArray( posLoc );
gl.disableVertexAttribArray( colLoc );
gl.vertexAttrib4f( colLoc, 0, 0, 0, 1 );
gl.enableVertexAttribArray( texLoc9 );
gl.vertexAttribPointer(texLoc9, 2, gl.FLOAT, false, 28, 12);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, texture9);
gl.uniform1i( sampler9, 0);
gl.enableVertexAttribArray( ofsLoc9 );
gl.vertexAttribPointer(ofsLoc9, 2, gl.FLOAT, false, 28, 20);
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 28,  0);
gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);
// ****** text object 10 *******
gl.useProgram(prog10);
gl.bindBuffer(gl.ARRAY_BUFFER, buf10);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf10);
gl.uniformMatrix4fv( prMatLoc10, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc10, false, new Float32Array(mvMatrix.getAsArray()) );
gl.uniform2f( textScaleLoc10, 0.001488095, 0.001488095);
gl.enableVertexAttribArray( posLoc );
gl.disableVertexAttribArray( colLoc );
gl.vertexAttrib4f( colLoc, 0, 0, 0, 1 );
gl.enableVertexAttribArray( texLoc10 );
gl.vertexAttribPointer(texLoc10, 2, gl.FLOAT, false, 28, 12);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, texture10);
gl.uniform1i( sampler10, 0);
gl.enableVertexAttribArray( ofsLoc10 );
gl.vertexAttribPointer(ofsLoc10, 2, gl.FLOAT, false, 28, 20);
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 28,  0);
gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);
// ****** text object 11 *******
gl.useProgram(prog11);
gl.bindBuffer(gl.ARRAY_BUFFER, buf11);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf11);
gl.uniformMatrix4fv( prMatLoc11, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc11, false, new Float32Array(mvMatrix.getAsArray()) );
gl.uniform2f( textScaleLoc11, 0.001488095, 0.001488095);
gl.enableVertexAttribArray( posLoc );
gl.disableVertexAttribArray( colLoc );
gl.vertexAttrib4f( colLoc, 0, 0, 0, 1 );
gl.enableVertexAttribArray( texLoc11 );
gl.vertexAttribPointer(texLoc11, 2, gl.FLOAT, false, 28, 12);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, texture11);
gl.uniform1i( sampler11, 0);
gl.enableVertexAttribArray( ofsLoc11 );
gl.vertexAttribPointer(ofsLoc11, 2, gl.FLOAT, false, 28, 20);
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 28,  0);
gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);
// ****** lines object 12 *******
gl.useProgram(prog12);
gl.bindBuffer(gl.ARRAY_BUFFER, buf12);
gl.uniformMatrix4fv( prMatLoc12, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc12, false, new Float32Array(mvMatrix.getAsArray()) );
gl.enableVertexAttribArray( posLoc );
gl.disableVertexAttribArray( colLoc );
gl.vertexAttrib4f( colLoc, 0, 0, 0, 1 );
gl.lineWidth( 1 );
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 12,  0);
gl.drawArrays(gl.LINES, 0, 10);
// ****** text object 13 *******
gl.useProgram(prog13);
gl.bindBuffer(gl.ARRAY_BUFFER, buf13);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf13);
gl.uniformMatrix4fv( prMatLoc13, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc13, false, new Float32Array(mvMatrix.getAsArray()) );
gl.uniform2f( textScaleLoc13, 0.001488095, 0.001488095);
gl.enableVertexAttribArray( posLoc );
gl.disableVertexAttribArray( colLoc );
gl.vertexAttrib4f( colLoc, 0, 0, 0, 1 );
gl.enableVertexAttribArray( texLoc13 );
gl.vertexAttribPointer(texLoc13, 2, gl.FLOAT, false, 28, 12);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, texture13);
gl.uniform1i( sampler13, 0);
gl.enableVertexAttribArray( ofsLoc13 );
gl.vertexAttribPointer(ofsLoc13, 2, gl.FLOAT, false, 28, 20);
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 28,  0);
gl.drawElements(gl.TRIANGLES, 24, gl.UNSIGNED_SHORT, 0);
// ****** lines object 14 *******
gl.useProgram(prog14);
gl.bindBuffer(gl.ARRAY_BUFFER, buf14);
gl.uniformMatrix4fv( prMatLoc14, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc14, false, new Float32Array(mvMatrix.getAsArray()) );
gl.enableVertexAttribArray( posLoc );
gl.disableVertexAttribArray( colLoc );
gl.vertexAttrib4f( colLoc, 0, 0, 0, 1 );
gl.lineWidth( 1 );
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 12,  0);
gl.drawArrays(gl.LINES, 0, 10);
// ****** text object 15 *******
gl.useProgram(prog15);
gl.bindBuffer(gl.ARRAY_BUFFER, buf15);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf15);
gl.uniformMatrix4fv( prMatLoc15, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc15, false, new Float32Array(mvMatrix.getAsArray()) );
gl.uniform2f( textScaleLoc15, 0.001488095, 0.001488095);
gl.enableVertexAttribArray( posLoc );
gl.disableVertexAttribArray( colLoc );
gl.vertexAttrib4f( colLoc, 0, 0, 0, 1 );
gl.enableVertexAttribArray( texLoc15 );
gl.vertexAttribPointer(texLoc15, 2, gl.FLOAT, false, 28, 12);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, texture15);
gl.uniform1i( sampler15, 0);
gl.enableVertexAttribArray( ofsLoc15 );
gl.vertexAttribPointer(ofsLoc15, 2, gl.FLOAT, false, 28, 20);
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 28,  0);
gl.drawElements(gl.TRIANGLES, 24, gl.UNSIGNED_SHORT, 0);
// ****** lines object 16 *******
gl.useProgram(prog16);
gl.bindBuffer(gl.ARRAY_BUFFER, buf16);
gl.uniformMatrix4fv( prMatLoc16, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc16, false, new Float32Array(mvMatrix.getAsArray()) );
gl.enableVertexAttribArray( posLoc );
gl.disableVertexAttribArray( colLoc );
gl.vertexAttrib4f( colLoc, 0, 0, 0, 1 );
gl.lineWidth( 1 );
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 12,  0);
gl.drawArrays(gl.LINES, 0, 8);
// ****** text object 17 *******
gl.useProgram(prog17);
gl.bindBuffer(gl.ARRAY_BUFFER, buf17);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf17);
gl.uniformMatrix4fv( prMatLoc17, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc17, false, new Float32Array(mvMatrix.getAsArray()) );
gl.uniform2f( textScaleLoc17, 0.001488095, 0.001488095);
gl.enableVertexAttribArray( posLoc );
gl.disableVertexAttribArray( colLoc );
gl.vertexAttrib4f( colLoc, 0, 0, 0, 1 );
gl.enableVertexAttribArray( texLoc17 );
gl.vertexAttribPointer(texLoc17, 2, gl.FLOAT, false, 28, 12);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, texture17);
gl.uniform1i( sampler17, 0);
gl.enableVertexAttribArray( ofsLoc17 );
gl.vertexAttribPointer(ofsLoc17, 2, gl.FLOAT, false, 28, 20);
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 28,  0);
gl.drawElements(gl.TRIANGLES, 18, gl.UNSIGNED_SHORT, 0);
// ****** lines object 18 *******
gl.useProgram(prog18);
gl.bindBuffer(gl.ARRAY_BUFFER, buf18);
gl.uniformMatrix4fv( prMatLoc18, false, new Float32Array(prMatrix.getAsArray()) );
gl.uniformMatrix4fv( mvMatLoc18, false, new Float32Array(mvMatrix.getAsArray()) );
gl.enableVertexAttribArray( posLoc );
gl.disableVertexAttribArray( colLoc );
gl.vertexAttrib4f( colLoc, 0, 0, 0, 1 );
gl.lineWidth( 1 );
gl.vertexAttribPointer(posLoc,  3, gl.FLOAT, false, 12,  0);
gl.drawArrays(gl.LINES, 0, 24);
gl.flush ();
}
var vpx0 = {
1: 0
};
var vpy0 = {
1: 0
};
var vpWidths = {
1: 504
};
var vpHeights = {
1: 504
};
var activeModel = {
1: 1
};
var activeProjection = {
1: 1
};
var listeners = {
1: [ 1 ]
};
var whichSubscene = function(coords){
if (0 <= coords.x && coords.x <= 504 && 0 <= coords.y && coords.y <= 504) return(1);
return(1);
}
var translateCoords = function(subsceneid, coords){
return {x:coords.x - vpx0[subsceneid], y:coords.y - vpy0[subsceneid]};
}
var vlen = function(v) {
return sqrt(v[0]*v[0] + v[1]*v[1] + v[2]*v[2])
}
var xprod = function(a, b) {
return [a[1]*b[2] - a[2]*b[1],
a[2]*b[0] - a[0]*b[2],
a[0]*b[1] - a[1]*b[0]];
}
var screenToVector = function(x, y) {
var width = vpWidths[activeSubscene];
var height = vpHeights[activeSubscene];
var radius = max(width, height)/2.0;
var cx = width/2.0;
var cy = height/2.0;
var px = (x-cx)/radius;
var py = (y-cy)/radius;
var plen = sqrt(px*px+py*py);
if (plen > 1.e-6) { 
px = px/plen;
py = py/plen;
}
var angle = (SQRT2 - plen)/SQRT2*PI/2;
var z = sin(angle);
var zlen = sqrt(1.0 - z*z);
px = px * zlen;
py = py * zlen;
return [px, py, z];
}
var rotBase;
var trackballdown = function(x,y) {
rotBase = screenToVector(x, y);
var l = listeners[activeModel[activeSubscene]];
saveMat = new Object();
for (var i = 0; i < l.length; i++) 
saveMat[l[i]] = new CanvasMatrix4(userMatrix[l[i]]);
}
var trackballmove = function(x,y) {
var rotCurrent = screenToVector(x,y);
var dot = rotBase[0]*rotCurrent[0] + 
rotBase[1]*rotCurrent[1] + 
rotBase[2]*rotCurrent[2];
var angle = acos( dot/vlen(rotBase)/vlen(rotCurrent) )*180./PI;
var axis = xprod(rotBase, rotCurrent);
var l = listeners[activeModel[activeSubscene]];
for (i = 0; i < l.length; i++) {
userMatrix[l[i]].load(saveMat[l[i]]);
userMatrix[l[i]].rotate(angle, axis[0], axis[1], axis[2]);
}
drawScene();
}
var y0zoom = 0;
var zoom0 = 0;
var zoomdown = function(x, y) {
y0zoom = y;
zoom0 = new Object();
l = listeners[activeProjection[activeSubscene]];
for (i = 0; i < l.length; i++)
zoom0[l[i]] = log(zoom[l[i]]);
}
var zoommove = function(x, y) {
l = listeners[activeProjection[activeSubscene]];
for (i = 0; i < l.length; i++)
zoom[l[i]] = exp(zoom0[l[i]] + (y-y0zoom)/height);
drawScene();
}
var y0fov = 0;
var fov0 = 1;
var fovdown = function(x, y) {
y0fov = y;
l = listeners[activeProjection[activeSubscene]];
for (i = 0; i < l.length; i++)
fov0 = fov[l[i]];
}
var fovmove = function(x, y) {
l = listeners[activeProjection[activeSubscene]];
for (i = 0; i < l.length; i++)
fov[l[i]] = max(1, min(179, fov0[l[i]] + 180*(y-y0fov)/height));
drawScene();
}
var mousedown = [trackballdown, zoomdown, fovdown];
var mousemove = [trackballmove, zoommove, fovmove];
function relMouseCoords(event){
var totalOffsetX = 0;
var totalOffsetY = 0;
var currentElement = canvas;
do{
totalOffsetX += currentElement.offsetLeft;
totalOffsetY += currentElement.offsetTop;
currentElement = currentElement.offsetParent;
}
while(currentElement)
var canvasX = event.pageX - totalOffsetX;
var canvasY = event.pageY - totalOffsetY;
return {x:canvasX, y:canvasY}
}
canvas.onmousedown = function ( ev ){
if (!ev.which) // Use w3c defns in preference to MS
switch (ev.button) {
case 0: ev.which = 1; break;
case 1: 
case 4: ev.which = 2; break;
case 2: ev.which = 3;
}
drag = ev.which;
var f = mousedown[drag-1];
if (f) {
var coords = relMouseCoords(ev);
coords.y = height-coords.y;
activeSubscene = whichSubscene(coords);
coords = translateCoords(activeSubscene, coords);
f(coords.x, coords.y); 
ev.preventDefault();
}
}    
canvas.onmouseup = function ( ev ){	
drag = 0;
}
canvas.onmouseout = canvas.onmouseup;
canvas.onmousemove = function ( ev ){
if ( drag == 0 ) return;
var f = mousemove[drag-1];
if (f) {
var coords = relMouseCoords(ev);
coords.y = height - coords.y;
coords = translateCoords(activeSubscene, coords);
f(coords.x, coords.y);
}
}
var wheelHandler = function(ev) {
var del = 1.1;
if (ev.shiftKey) del = 1.01;
var ds = ((ev.detail || ev.wheelDelta) > 0) ? del : (1 / del);
l = listeners[activeProjection[activeSubscene]];
for (i = 0; i < l.length; i++)
zoom[l[i]] *= ds;
drawScene();
ev.preventDefault();
};
canvas.addEventListener("DOMMouseScroll", wheelHandler, false);
canvas.addEventListener("mousewheel", wheelHandler, false);
}
</script>
<canvas id="unnamed_chunk_1canvas" width="1" height="1"></canvas> 
<p id="unnamed_chunk_1debug">
You must enable Javascript to view this page properly.</p>
<script>unnamed_chunk_1webGLStart();</script>

---

## Gameplan
* Load `mothur-1.39.5` AMI
* Discuss project organization and data hygiene
* Run example dataset through [MiSeq SOP](http://www.mothur.org/wiki/MiSeq_SOP)
* Dataset comes from a study of C57BL/6 mice that were sampled for 6 months. Study was [originally published](http://www.ncbi.nlm.nih.gov/pubmed/22688727) in Gut Microbes
* Work through alpha and beta diversity analysis methods and population-level analyses
